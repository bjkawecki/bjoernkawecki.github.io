{% assign current_lang = site.active_lang | default: site.default_lang | default: 'de' %}
{% assign lang_prefix = '' %}
{% unless current_lang == site.default_lang %}
  {% assign lang_prefix = '/' | append: current_lang %}
{% endunless %}
{% assign nav_about_path = lang_prefix | append: '/' %}
{% assign nav_projects_path = lang_prefix | append: '/projects/' %}
{% assign nav_blog_path = lang_prefix | append: '/blog/' %}
{% assign contact_href = site.data[current_lang].strings.header.contact_cta_href | default: '#contact' %}
{% assign contact_label = site.data[current_lang].strings.header.contact_cta | default: 'Kontakt' %}
{% assign menu_open_label = site.data[current_lang].strings.header.menu_open | default: 'Menü öffnen' %}
{% assign menu_close_label = site.data[current_lang].strings.header.menu_close | default: 'Menü schließen' %}
{% assign header_strings = site.data[current_lang].strings %}
<header class="sticky top-0 z-40 border-b border-gray-200 bg-white/80 backdrop-blur transition dark:border-zinc-800 dark:bg-zinc-900/70">
  <div class="max-w-6xl px-5 md:px-6 lg:px-8 mx-auto">
    <div class="flex items-center justify-between py-4 md:py-5 gap-4">
      <a
        href="{{ site.baseurl }}{{ nav_about_path }}"
        class="text-xl font-bold tracking-tight text-gray-900 transition hover:text-accent-600 dark:text-white dark:hover:text-accent-300"
        aria-label="Björn Kawecki – {{ header_strings.aside.profession }}"
      >
        Björn Kawecki
      </a>
      <div class="flex items-center gap-3">
        <button
          id="toggle-color-mode"
          type="button"
          class="flex items-center justify-center w-9 h-9 rounded-full border border-gray-200 text-gray-600 transition hover:border-accent-500 hover:text-accent-600 dark:border-zinc-700 dark:text-gray-300 dark:hover:border-accent-500 dark:hover:text-accent-200"
          aria-label="{{ header_strings.footer.theme_toggle_label }}"
          aria-pressed="false"
        ></button>
        <div class="flex items-center gap-1 text-sm font-medium">
          {% for tongue in site.languages %}
            {% assign language_code = site.data[tongue].strings.language_code | default: tongue | upcase %}
            {% if tongue == site.active_lang %}
              <span class="px-2 py-1 rounded-md bg-accent-100 text-accent-600 dark:bg-accent-900/50 dark:text-accent-200">
                {{ language_code }}
              </span>
            {% else %}
              {% assign language_name = site.data[tongue].strings.language_name %}
              {% assign lang_href = nil %}
              {% if page.page_id and site.data.post_translations[page.page_id] and site.data.post_translations[page.page_id][tongue] %}
                {% assign slug_for_lang = site.data.post_translations[page.page_id][tongue] %}
                {% if tongue == site.default_lang %}
                  {% assign lang_href = site.baseurl | append: "/blog/" | append: slug_for_lang | append: ".html" %}
                {% else %}
                  {% assign lang_href = site.baseurl | append: "/" | append: tongue | append: "/blog/" | append: slug_for_lang | append: ".html" %}
                {% endif %}
              {% endif %}
              {% if lang_href == nil and page.page_id %}
                {% for doc in site.documents %}
                  {% if doc.page_id == page.page_id and (doc.lang == tongue or doc.locale == tongue) %}
                    {% assign lang_href = site.baseurl | append: doc.url %}
                    {% if lang_href contains ":title" and doc.slug %}
                      {% assign lang_href = site.baseurl | append: "/blog/" | append: doc.slug | append: ".html" %}
                      {% if tongue != site.default_lang %}
                        {% assign lang_href = site.baseurl | append: "/" | append: tongue | append: "/blog/" | append: doc.slug | append: ".html" %}
                      {% endif %}
                    {% elsif tongue != site.default_lang and lang_href != nil %}
                      {% unless lang_href contains "/" | append: tongue | append: "/" %}
                        {% assign lang_href = site.baseurl | append: "/" | append: tongue | append: doc.url %}
                      {% endunless %}
                    {% endif %}
                    {% break %}
                  {% endif %}
                {% endfor %}
                {% if lang_href == nil %}
                  {% for doc in site.pages %}
                    {% if doc.page_id == page.page_id and (doc.lang == tongue or doc.locale == tongue) %}
                      {% assign lang_href = site.baseurl | append: doc.url %}
                      {% break %}
                    {% endif %}
                  {% endfor %}
                {% endif %}
              {% endif %}
              {% if lang_href == nil %}
                {% assign target_url = page.permalink_lang[tongue] | default: nil %}
                {% assign use_target = false %}
                {% if target_url %}
                  {% if target_url contains ":title" %}
                    {% assign use_target = false %}
                  {% else %}
                    {% assign use_target = true %}
                  {% endif %}
                {% endif %}
                {% if use_target %}
                  {% if tongue == site.default_lang %}
                    {% assign lang_href = site.baseurl | append: target_url %}
                  {% else %}
                    {% assign lang_href = site.baseurl | append: '/' | append: tongue | append: target_url %}
                  {% endif %}
                {% else %}
                  {% if tongue == site.default_lang %}
                    {% assign lang_href = site.baseurl | append: page.url %}
                  {% else %}
                    {% assign lang_href = site.baseurl | append: '/' | append: tongue | append: page.url %}
                  {% endif %}
                {% endif %}
              {% endif %}
              {% if lang_href contains ":title" %}
                {% assign lang_href = site.baseurl | append: page.url %}
                {% if tongue != site.default_lang %}
                  {% assign lang_href = site.baseurl | append: '/' | append: tongue | append: page.url %}
                {% endif %}
              {% endif %}
              <a
                class="px-2 py-1 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-50 dark:hover:bg-zinc-800 transition"
                {% static_href %}href="{{ lang_href }}"{% endstatic_href %}
                aria-label="{{ header_strings.footer.language_label }} {{ language_name }}"
              >
                {{ language_code }}
              </a>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</header>

